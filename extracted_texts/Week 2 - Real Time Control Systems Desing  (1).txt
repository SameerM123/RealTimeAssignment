
--- Page 1 ---
Real-Time Systems Testing Methods: Plant Models
• What is a plant model?
• A plant model is a dynamic model expressed mathematically 
with a set of differential equations that describe the dynamic 
behaviour of the process
• How do we develop a dynamic model?
1. By using principles of underlying physics
2. By testing a prototype of the device and performing 
measurements of response to various inputs and using the 
collected data to construct an analytical model
Week 2 - Real Time Control Systems Desing
ENGG*4420
1

--- Page 2 ---
Modeling the 
PT326 Process 
Trainer: plant 
used in our 
labs
ENGG4420: Developed by Radu Muresan, F22
Solution: the PT326 
unit falls in the category 
of thermal 
processes.
The principles that 
governs the behavior of 
the thermal process in 
PT326 apparatus is the 
balance of heat 
energy!!
Week 2 - Real Time Control Systems Desing
ENGG*4420
2

--- Page 3 ---
Heat and Fluid-Flow Models
• The dynamic models of temperature control systems involve the 
flow and storage of heat energy
• There are 3 different ways of heat flow from one object to 
another:
• Conduction, convection and radiation
• Heat energy flows through a substance due to transfer of heat:
• q = …
• The temperature of the substance is affected by the heat flow as:
• dT/dt = …
Week 2 - Real Time Control Systems Desing
ENGG*4420
3

--- Page 4 ---
Example of Heat Flow Calculations
• We consider a room 
which has two sides 
un-insulated.
• Derive the system 
model that produces 
the temperature in 
the room
Week 2 - Real Time Control Systems Desing
ENGG*4420
4

--- Page 5 ---
Specific Heat and Thermal Conductivity
• These are material properties that are given in tables and can be 
used to calculate thermal capacity C and thermal resistance R for 
a substance of interest
• cv: specific heat is the heat capacity per unit mass of material. 
This can be used to calculate C as:
• C = …
• k: thermal conductivity is the property of the material to conduct 
heat. R is related to k by the following relation:
• 1/R = …
Week 2 - Real Time Control Systems Desing
ENGG*4420
5

--- Page 6 ---
PT326 System Model
• We characterize a small volume 
around the heating element – the 
heated air from around the 
element will flow in the tube.
• What are the heat flow sources in 
and out of this volume?
• The rate of heat accumulated in 
volume V is:
• qa = …
Week 2 - Real Time Control Systems Desing
ENGG*4420
6

--- Page 7 ---
PT326 Apparatus, Model Equations
• We use two expressions for heat accumulation in volume V in 
order to get the model for the temperature rise ΔT as a function 
of the heat flow generated by the apparatus heat element 
resistor R
• Assumptions: the only heat accumulated in volume V is due to 
the heat transferred from the heating element, the other 
components are negligible
• We follow up with equations (8), (9) and (10) -- See Lecture 
Notes -- to derive the model equation (11) for a small rise of 
temperature ΔT in volume V as:
• (11):
Week 2 - Real Time Control Systems Desing
ENGG*4420
7

--- Page 8 ---
Transfer Function of the Process Trainer 
Model
• Taking the Laplace transform of our derived equation (11) we 
get the transfer function of the system in the frequency 
domain as: transfer function = output/input 
• Equations (12), (13):
• (12):
Week 2 - Real Time Control Systems Desing
ENGG*4420
8

--- Page 9 ---
Transfer Function of the Process Trainer Model 
with Transport Delay
• Note that the temperature sensor is placed at a distance 
down the tube from the heat source.
• This will introduce transport delay for our model if we 
consider the transfer function as:
(sensor voltage)/(heat source voltage) → equation (14):
• (14):
ENGG4420: Developed by Radu Muresan, F22
Week 2 - Real Time Control Systems Desing
ENGG*4420
9

--- Page 10 ---
System Model Block Diagram of the PT326 
Apparatus
Week 2 - Real Time Control Systems Desing
ENGG*4420
10

--- Page 11 ---
How Do We Determine τd and τ
• Constants τd and τ that are part
of our P326 apparatus model
and are important for a real-
time system designer for the
purpose of defining correct 
sampling intervals
• By using system step response
we can measure these 
parameters
• In the laboratory manual we
provide these parameters for
different openings of the blower 
cover
Week 2 - Real Time Control Systems Desing
ENGG*4420
11

--- Page 12 ---
Dynamic Models of Mechanical Systems
• The Newton’s law equation of motion is key for developing a 
mathematical model of a mechanical system
• F = m∙a
• Application of Newton’s law involves:
• Define convenient coordinates to account for the body’s motion
• Determine the forces on the body using the free-body diagram
• Write the equations of motion
Week 2 - Real Time Control Systems Desing
ENGG*4420
12

--- Page 13 ---
Equation Model Example: Cruise Control
• The transfer function for the cruise control system is: 
TF = (velocity of the car v)/(engine force u)
• V(s)/U(s) = ?
Week 2 - Real Time Control Systems Desing
ENGG*4420
13

--- Page 14 ---
Models of Electrical Circuits
• The basic equations of electric circuits are based on 
Kirchoff's laws:
• Kirchoff's current law (KCL) states that the sum of currents leaving 
a junction or node equals the algebraic sum of currents entering 
the node.
• Kirchoff's voltage law (KVL) states that the algebraic sum of all 
voltages taken around a closed path in a circuit is zero.
Week 2 - Real Time Control Systems Desing
ENGG*4420
14

--- Page 15 ---
• Electric current and magnetic fields interact in two ways that 
are important in the operation of electromechanical actuators 
and sensors:
a. LAW OF MOTORS: If a current of i amperes [A] in a conductor of length l 
meters is arranged at right angles in a magnetic field of B tesla [T], then 
there is a force on the conductor at right angles to the plane formed by 
i and B, with magnitude of:
• F = B∙l∙i  [Newton].
b.LAW OF GENERATORS: If a conductor of length l meters is moving in a 
magnetic field of B Tesla at a velocity of v [m/s] at mutually right 
angles, an electric voltage is established across the conductor with 
magnitude:
• e(t) = B∙l∙v [Volts].
Models of Electromechanical Systems
Week 2 - Real Time Control Systems Desing
ENGG*4420
15

--- Page 16 ---
Modeling Example: DC Motor
Week 2 - Real Time Control Systems Desing
ENGG*4420
16

--- Page 17 ---
The Transfer Function of the Motor
• TF = (motor angular rotation θm)/(armature voltage va)
• Θm(s)/Va(s) = …
Week 2 - Real Time Control Systems Desing
ENGG*4420
17

--- Page 18 ---
Assignments
• Review all examples in lecture notes and check the 
homework given in lecture notes.
• Review the model for mechanical and electromechanical 
systems (only as presented in the power points 
presentations during the class lectures)
Week 2 - Real Time Control Systems Desing
ENGG*4420
18

--- Page 19 ---
Hard Real-Time Constraints Tasks, Implementation 
Methods
• In our hot-air blower system example the control task and 
the clock/calendar task are hard-real time tasks due to their 
tight time constraints (ms order)
• In this section, we introduce general considerations related 
to the implementation of hard-real time control task
• We shall consider:
• The digital form of a PID control algorithm, implementation details
• Timing requirements and choice of sampling interval
Week 2 - Real Time Control Systems Desing
ENGG*4420
19

--- Page 20 ---
The Diagram of a Continuous Control System 
with Feedback
• In this diagram here we show a simplified block diagram of 
the feedback part of a system such as the temperature 
control or air blower control applicable to our hot air unit.
r(t) – set point; c(t) – controlled variable; e(t) = r(t) – c(t) –> error; 
m(t) – manipulated variable.
Week 2 - Real Time Control Systems Desing
ENGG*4420
20

--- Page 21 ---
Sampled Feedback Control System, Block Diagram
• A digitization process is applied in order to interface to the computer controlling a plant.
• The digital computer system will sample the plant to generate the input data image and 
will generate an output data image to interface with the plant.
The symbols c(nT), r(nT), e(nT), and u(nT) are the sampled values of c(t), r(t), e(t), 
and u(t), respectively, at sample times nT where n is an integer and T is the 
sampling interval.
Week 2 - Real Time Control Systems Desing
ENGG*4420
21

--- Page 22 ---
PID Controller
• For a wide range of industrial processes, the PID controller 
achieves a good performance in controlling the system.
• For this reason, the PID and PI algorithms are widely used.
• m(t) =
• The PID controller contains three main terms:
• proportional – characterized by the proportional gain Kp
• Integral – characterized by the integral action time Ti
• Differential – characterized by the derivative action time Td
• See Lecture Notes for further reading on PID control.
Week 2 - Real Time Control Systems Desing
ENGG*4420
22

--- Page 23 ---
Direct Digital Control, The PID Equations
• The differential equation presented is the time domain 
representation of the controller.
• Applying Laplace transform we can derive the equivalent 
frequency domain representation as:
• Gc(s) = M(s)/E(s) =
• Both the time domain t and frequency domain s
representations are continuous representations
Week 2 - Real Time Control Systems Desing
ENGG*4420
23

--- Page 24 ---
Frequency Domain Control System, Block Diagram
• In the frequency domain the overall system of controller and 
plant can be represented by a continuous form and discrete 
form.
Week 2 - Real Time Control Systems Desing
ENGG*4420
24

--- Page 25 ---
The Discrete Representation of the PID Controller
• Both the time domain t and frequency domain s 
representations are continuous representations
• To implement the controller as a real-time task we need a 
digital algorithm.
• For this we need to convert from the continuous form into 
the discrete form of the controller representation
• There are several methods to do this but for the purpose of 
this course we present only the use of first-order finite 
differences.
Week 2 - Real Time Control Systems Desing
ENGG*4420
25

--- Page 26 ---
First Order Finite Difference Method for PID 
Algorithm Conversion
• In the time domain m(t) version of the controller we replace the 
differential and integral terms by their first order discrete 
equivalents => the discrete equation for m(n)
• Discrete equivalents …
• m(n) =
• Where m(n) represents the value of m at some time interval nΔt
Week 2 - Real Time Control Systems Desing
ENGG*4420
26

--- Page 27 ---
Discrete PID Algorithm For the Controller: 
Hard Real Time Periodic Algorithm
• The discrete equation m(n) for the PID controller can be 
easily transformed into a digital program algorithm as 
follows:
Where: m(n) =m(nΔt); e(n) = e(nΔt); and Δt = Ts is the sample period 
Ki and Kd are new parameters defined as:
• Ki = Kp(Ts/Ti); and Kd = Kp(Td/Ts);
Week 2 - Real Time Control Systems Desing
ENGG*4420
27

--- Page 28 ---
Basic Programming Statements: Hard Time 
Periodic PID Digital Algorithm
• In implementing this algorithm, we could assume that:
• the plant output is obtained by using an ADC to sample and convert the output signal,
• the actuator control signal is outputted through a DAC to the actuator; and
• procedures ADC and DAC are available to read the ADC and to send values to the DAC.
Week 2 - Real Time Control Systems Desing
ENGG*4420
28

--- Page 29 ---
Summary of DDC Implementation of Controllers
• Can be implemented as real-time embedded applications
• A continuous time representation of a controller can be translated into a 
discrete equivalent using Z transform analysis
• Digital controllers use sampled and quantized signals
• A controller that operates on signals that are sampled but not quantized is 
called DISCRETE
• A controller that operates on signals that are sampled and then 
quantized is called DIGITAL
• The digital computer function is to calculate the next control value
• The next control value will be converted by a DAC into analog signal
Week 2 - Real Time Control Systems Desing
ENGG*4420
29

--- Page 30 ---
Summary of DDC Implementation of Controllers
• The use of detailed plant models allows a wide variety of methods to be 
used in the design of the controller
• Specifically, two types of representation are common:
• State-space representation of the difference equations, and
• Transfer function in z-1
• If controller is represented in difference equation form it can be 
programmed directly as a digital algorithm
• If the controller is given as a transfer function in z domain, then we can 
use some techniques to convert it into difference equations
• Direct method 1 and method 2 – See Lecture Notes.
• Cascade implementation and parallel implementation – See Lecture Notes.
Week 2 - Real Time Control Systems Desing
ENGG*4420
30

--- Page 31 ---
Practical Considerations for the Implementation of 
the Real-Time PID Controller Task
1. Coefficients Ki and Kd are dependent of Ts (sampling period)
• For correct operation we should consider the sampling period Ts as 
a variable
2. The control task is a cyclic hard real-time task -- what 
synchronization method between the program and the 
plant can be used?
• Polling; external interrupts; ballast coding; and real-time clock 
signals.
The basic PID algorithm
Week 2 - Real Time Control Systems Desing
ENGG*4420
31

--- Page 32 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
3. Bumpless transfer – this relates to the requirement that 
manual/automatic modes change over be made smoothly
• Common methods are:
• Tracking of operator settings
• Velocity algorithm (most common) – the velocity algorithm gives the 
change in the value of the manipulated variable at each sample time 
rather than the absolute value of the variable:
• Δm = m(n) – m(n-1) ...
Week 2 - Real Time Control Systems Desing
ENGG*4420
32

--- Page 33 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
4. Saturation and integral action wind-up – relates to the fact 
that the manipulated variable m(n) is limited by physical 
constraints and the program should take these constraints 
in consideration to avoid integral term build up due to 
error that cannot be compensated.
• Common solutions:
• Use the velocity algorithm
• Introduce limits on the summation term when the actuator’s physical 
limits are encountered.
Week 2 - Real Time Control Systems Desing
ENGG*4420
33

--- Page 34 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
5. Tuning – relates to the design of the parameters Kp, Ti and Td 
that are part of the PID controller task (See lab manual)
• Tuning methods:
• All tuning methods are based on simple plant measurements and on the 
assumption that the plant to be controlled can be model by a first order transfer 
function
• Ziegler-Nichols rules based on open loop step: tuning gives some values for Kp, Ti 
and Td as function of transfer characteristic parameters of the plant; specifically, 
R (the slope of the transfer function), L (plant lag)
• Ziegler-Nichols rules based on the closed feedback loop: tuning gives some 
values for Kp, Ti and Td in terms of the close loop measurements; specifically, 
loop gain Km at steady state oscillations, and period of steady state oscillations 
Tp
Week 2 - Real Time Control Systems Desing
ENGG*4420
34

--- Page 35 ---
Practical Considerations for the Implementation of 
the Real-Time PID Controller Task
6. Choice of sampling interval – the upper and lower 
boundaries for Ts relate to the feedback loop 
destabilization and computer resolution, respectively.
• We give some common empirical rules that can be applied:
a. Dominant plant time constant, Tp: …
b. Assumption of Ziegler-Nichols plant model – the plant model is 
given as first order plant model: …
c. Closed-loop performance requirements– the closed-loop system 
is required to have a settling time of Tss: …
Week 2 - Real Time Control Systems Desing
ENGG*4420
35

--- Page 36 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
7. Plant input and output – we need to consider that the 
sampled signals used to calculate our error values are noisy 
signals and might also need scaling and conditioning.
• Divide the software into segments where:
• The plant input is responsible for filtering, scaling and calibration 
operations.
• The plant output module converts the output image into the appropriate form 
required to drive the actuator.
Week 2 - Real Time Control Systems Desing
ENGG*4420
36

--- Page 37 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
8. Computational delay -- is the time difference between sampling 
the plant output and changing the value of the actuator
• It is a function of: (input/output speed of the processor) + (type and 
amount of computation) + (controller operation ordering)
• Controller ordering 1:
1.
read plant input data;
2.
calculate control output;
3.
send output to actuator
• Controller ordering 2:
1.
send to plant the control value for sample interval (k-1);
2.
read input data for sample interval k;
3.
calculate control output for kth sample interval
Week 2 - Real Time Control Systems Desing
ENGG*4420
37

--- Page 38 ---
Practical Considerations for the Implementation of the 
Real-Time PID Controller Task
9. For positional and velocity algorithms we can use the 
trapezoid rule instead of the rectangular rule to 
approximate the integral summation term.
10. Differentiation normally will accentuate noise and data 
errors => some form of smoothing (filtering) is needed
• Average over several samples – four-point central difference 
method.
• m(n) = …
Week 2 - Real Time Control Systems Desing
ENGG*4420
38

--- Page 39 ---
Real-Time 
Control Task 
Implementation
• The pseudo code algorithm 
for the real time task is =>
• HOMEWORK!
• Improve this pseudo code 
by including all practical 
consideration elements 
presented!!
Week 2 - Real Time Control Systems Desing
ENGG*4420
39

--- Page 40 ---
RTOS Topics
• So far, we argued the need for a RTOS support when 
implementing real-time control applications. However, the 
real-time applications are common in many areas of 
computing – see our examples in lecture 1.
• RTOS Topics
• Benchmarks for RTOS
• uC/OS-III Basics
• FreeRTOS
• DIdactic C Kernel (DICK) – example small kernel design
Week 2 - Real Time Control Systems Desing
ENGG*4420
40

--- Page 41 ---
Benchmarking Real-Time Systems
• Synthetic benchmarks are created based on statistical 
distribution of various instructions in an average program
• Older real-time systems benchmark are Rhealstone metric and 
Threadmetric. We look to Realstone metric to understand some 
parameters used to compare the performance of RTOSs
• In Realstone metric, six parameters of real-time systems are 
considered:
• 1) task switching time; 2) task preemption time; 3) interrupt latency 
time; 4) semaphore shuffling time; 5) unbounded priority inversion 
time; 6) datagram throughput time
Week 2 - Real Time Control Systems Desing
ENGG*4420
41

--- Page 42 ---
Task Switching Time: tts
• Task switching time is 
defined as the time it 
takes for one context 
switch among equal 
priority tasks
• tts = t2 – t1
• Task switching time is 
determined by the 
efficiency of the kernel 
data structure
Week 2 - Real Time Control Systems Desing
ENGG*4420
42

--- Page 43 ---
Task Preemption Time: ttp
• Task preemption time is 
defined as the time it takes 
to start the execution of a 
higher priority task 
(compared to the currently 
running task) after the 
condition enabling the task 
occurred.
• ttp = t3 – t1
• ttp has 3 parameters …
Week 2 - Real Time Control Systems Desing
ENGG*4420
43

--- Page 44 ---
Interrupt Latency Time: til
• Interrupt latency time is defined 
as the time it takes to start the 
execution of the required ISR 
after an interrupt occurs
• til = t3 – t1
• til consists of 4 components: …
Week 2 - Real Time Control Systems Desing
ENGG*4420
44

--- Page 45 ---
Semaphore Shuffling Time: tss
• Semaphore shuffling time is 
defined as the time that 
elapses between a lower 
priority task releasing a 
semaphore and a higher 
priority task to start running
• tss =
Week 2 - Real Time Control Systems Desing
ENGG*4420
45

--- Page 46 ---
Unbounded Priority Inversion Time: tup
• Unbounded priority 
inversion time is computed 
as the time it takes for the 
OS to recognize priority 
inversion (t1) and run the 
task holding the resource 
and start T3 after T1 
completes (t2)
• tup = t1 + t2
Week 2 - Real Time Control Systems Desing
ENGG*4420
46

--- Page 47 ---
Datagram Throughput Time: tdt
• Datagram throughput time indicates the number of kilobytes 
of data that can be transferred between two tasks without 
using shared memory or pointers.
• This parameter is designed to measure the efficiency of data 
structures handling message passing primitives that are part of the 
RTOS
Week 2 - Real Time Control Systems Desing
ENGG*4420
47

--- Page 48 ---
The Rhealstone Metric
• The Rhealstone metric is computed as a weighted average of the 
identified parameters:
• Rhealstone metric = a1*tts + a2*ttp + a3*til + a4*tss + a5*tup + 
a6*tdp;
• Where the parameters a1 to a6 are empirically determined
• The Rhealstone benchmark’s figure of merit is that it 
characterizes the kernel-hardware combination of a system …
• Drawbacks of Rhealstone metrics are:
• The ability of a system to meat deadlines of application is not measured
• The six measurements are somehow ad hoc, no practical justification
Week 2 - Real Time Control Systems Desing
ENGG*4420
48

--- Page 49 ---
Other Metrics
• Interrupt processing overhead – for this we calculate t20,000 
which represents the time to complete a task when 20,000 
interrupts occur per second
•I20,000 = (t20,000 – t0)/t0
• Where t0 is the time to complete a certain task when there are no 
interrupts
• Tridimensional measure TM considers 3 factors that affect the 
performance of a real-time system:
• TM = (MIPS1*MIPS2*NIOPS)1/3
• Where MIPS1 …
Week 2 - Real Time Control Systems Desing
ENGG*4420
49

--- Page 50 ---
Real Time Embedded Systems
• Real-time systems are 
systems whereby the 
correctness of the 
computed values and 
their timeliness are at 
the forefront.
• There are two types 
of real-time systems, 
hard and soft real 
time.
• Examples …
Week 2 - Real Time Control Systems Desing
ENGG*4420
50

--- Page 51 ---
Foreground/Background System or Super 
Loop
• Applies to small system 
with low complexity
• Foreground is called the 
interrupt level
• ISR handles asynchronous 
events
• Background is called the 
task level
• Note, critical task 
operations must be 
handled by ISRs now.
Week 2 - Real Time Control Systems Desing
ENGG*4420
51

--- Page 52 ---
Real-Time Operating System (RTOS) General 
Concept
• An RTOS is a program that 
schedules execution in a 
timely manner, manages 
system resources, and 
provides consistent 
foundation for developing 
application code
• An RTOS contains …
• An RTOS should be scalable
…
Week 2 - Real Time Control Systems Desing
ENGG*4420
52

--- Page 53 ---
Real-Time Kernel
• The kernel is the program that manages the time and resources 
of a microprocessor, microcontroller or DSP
• What is work or job? … 
What is a task? …
• A kernel is responsible to manage all tasks of an application in a 
multitasking system
• Multitasking is the process of scheduling and switching the CPU 
between several tasks
• General kernel components:
• Scheduler – implements a set of scheduling algorithms
• Objects – special kernel constructs such as semaphores, etc.
• Services – operations that are performed on an objects, or in general
Week 2 - Real Time Control Systems Desing
ENGG*4420
53

--- Page 54 ---
Preemptive Kernel
• uC/OS-III is a 
preemptive kernel
• Here, the kernel 
always runs the 
highest priority task 
that is ready to run
• Ex … See diagram …
• A kernel introduces 
time and memory 
overhead
Week 2 - Real Time Control Systems Desing
ENGG*4420
54
